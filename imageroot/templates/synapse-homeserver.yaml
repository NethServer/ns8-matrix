server_name: ${SYNAPSE_DOMAIN_NAME}
pid_file: /data/homeserver.pid
public_baseurl: https://${SYNAPSE_DOMAIN_NAME}/

listeners:
  - port: ${SYNAPSE_PORT}
    tls: false
    type: http
    x_forwarded: true
    bind_addresses: ['0.0.0.0']
    resources:
      - names: [client]

database:
  name: psycopg2
  txn_limit: 10000
  args:
    user: postgres
    password: ${POSTGRES_PASSWORD}
    database: synapse
    host: 127.0.0.1
    port: ${POSTGRES_PORT}
    cp_min: 5
    cp_max: 10

log_config: "/data/config/log.config"

media_store_path: /data/media_store
uploads_path: /data/uploads

max_upload_size: 50M
max_image_pixels: 32M

dynamic_thumbnails: false

url_preview_enabled: false

enable_registration: false

report_stats: false

macaroon_secret_key: ${MACAROON_SECRET}
form_secret: ${FORM_SECRET}
signing_key_path: "/data/${SYNAPSE_DOMAIN_NAME}.signing.key"

# Email configuration for notifications
email:
  enable_notifs: ${SYNAPSE_SMTP_ENABLED}
  smtp_host: "${SYNAPSE_SMTP_HOST}"
  smtp_port: ${SYNAPSE_SMTP_PORT}
  smtp_user: "${SYNAPSE_SMTP_USERNAME}"
  smtp_pass: "${SYNAPSE_SMTP_PASSWORD}"
  require_transport_security: ${SYNAPSE_SMTP_REQUIRE_TRANSPORT_SECURITY}
  notif_from: "${SYNAPSE_SMTP_FROM}"
  app_name: "Matrix Chat"

# LDAP auth configuration using matrix-synapse-ldap3
# This listener will allow authentication against an LDAP server.
modules:
  - module: "ldap_auth_provider.LdapAuthProviderModule"
    config:
      enabled: true
      uri: "ldap://${LDAP_HOST}:${LDAP_PORT}"
      start_tls: false
      base: "${LDAP_BASE_DN}"
      attributes:
        uid: "${LDAP_USERNAME}"
        mail: "${LDAP_EMAIL_ATTR}"
        name: "${LDAP_NAME_ATTR}"

suppress_key_server_warning: true
